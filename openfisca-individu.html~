<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../app-storage/app-localstorage/app-localstorage-document.html">

<!--
	`openfisca-individu`
	element indivivdu utile à openfisca-pension , scenaristeur/Pa-Comp
	
	@demo demo/index.html 
-->

<dom-module id="openfisca-individu">
	<template>
		<style>
			:host {
			display: block;
			}
		</style>
		<!-- LOCAL STORAGE -->
		<app-localstorage-document key="individus" data="{{individus}}">
		</app-localstorage-document>
		
		
		<h2>Indiquez les membres de la famille</h2>
		<!-- formulaire saisie membres -->
	    <paper-input id="indivNomInput" value="{{individu.id}}" label="Nom" ></paper-input>
		<paper-dropdown-menu label="Hierarchie">
			<paper-listbox 
			class="dropdown-content" 
			selected="{{hierId}}"
			attr-for-selected="myid">
				<template is="dom-repeat" items="{{hierarchies}}" as="hier" index-as="hierId">
					<paper-item myid="[[hierId]]">[[hier]]</paper-item>
				</template>
			</paper-listbox>
		</paper-dropdown-menu>
		<paper-input value="{{individu.date_naissance}}" label="Date de Naissance (01/01/1977)" ></paper-input>
		<paper-input value="{{individu.revenu_activite_salariale}}" label="Revenu Activite Salariale (annuel en €)"></paper-input>
		
		<paper-fab
		icon="add" 
		title="Ajouter un individu"
		on-tap="createIndividu"
		class="blue">
		</paper-fab>
		
		<!--affichage de la liste de individus -->
		<paper-icon-button icon="delete" on-tap="clearIndividus"></paper-icon-button>
		<template is="dom-repeat" items="{{individus}}">
			<paper-item  individu={{item}}>{{item.id}}, date de naissance :  {{item.date_naissance}} 
				<template is="dom-if" if="{{item.revenu_activite_salariale}}">
					
					<div>, revenus d'activité annuel :  {{item.revenu_activite_salariale}} €</div>
					
				</template>        
				
				<paper-icon-button icon="delete" on-tap="deleteIndividu"></paper-icon-button>
			</paper-item>
		</template>
	</template>
	
	<script>
		Polymer({
			
			is: 'openfisca-individu',
			
			properties: {
				prop1: {
					type: String,
					value: 'openfisca-individu',
				},
				hierarchies :{
					type : Array,
					value : ["Père","Mère","Enfant"]      
				},
				hierarchie : {
					computed : 'computeHierarchie(hierId)',
					type : String,
					notify : true
				},
				hierId : {
					notify : true      
				}   ,
				
				/**
					*Definition des détails d'un individu
					*/
					individu: {
						type : Object,
						notify : true,
						value:{	}
					},
					/**
						* La liste des individus
						*/
						individus: {
							type : Array,
							notify : true,
							value : []
						},
					},
					computeHierarchie : function(id){
						console.log(id);
						return id;
					}  ,       
					
					createIndividu: function(e){
						console.log(this.individu);
						if (this.individu.id!=""){
							this.individu.hierarchie=this.hierId; 
							this.push('individus', this.individu);
							console.log(this.individus);
							//Update manuelle des arrays
							var indivTemp=this.individus;
							this.individus=[];
							his.individus=indivTemp;
							this.individu={};
							console.log(this.individus);
						}
						else{
							console.log("ne peut être vide");
							// this.$.toast0.open();
							// this.$.toast0.fitInto = this.$.indivNomInput;
						}
					},
					deleteIndividu: function(e){
						console.log(e.model.item)
						var indiv= e.model.item;
						var index=this.individus.indexOf(indiv);
						console.log(index);
						if (index != -1) {
    							this.splice('individus',index, 1);
							}
							console.log(this.individus);
					},
					clearIndividus:function(){
						this.individus = [];
					}
				});
			</script>
		</dom-module>
		